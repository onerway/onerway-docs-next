---
name: code-review
description: 对代码改动进行系统性审查，按严重度输出问题与建议
argument-hint: [文件或目录]
allowed-tools: Read, Grep, Bash(git:*), AskUserQuestion
---

# 用途

对指定文件或当前改动进行代码审查，重点发现功能风险、可维护性问题和安全隐患，输出结构化结论与优先级。

**审查范围**：`$ARGUMENTS`（未提供时审查最新改动的文件/diff）

---

## 快速使用

```bash
# 审查最近改动
/code-review

# 指定文件
/code-review app/components/content/ProseTabs.vue

# 指定目录（递归读取）
/code-review app/composables
```

---

## 工作流程

1. **确定范围**
   - 若未提供路径，运行 `git status` 与 `git diff --stat`
     获取改动列表
   - 询问用户是否聚焦特定文件/功能（如性能/安全）
2. **阅读上下文**
   - 使用 Read/Grep 查看相关文件、类型定义、配置和测试
   - 注意：不修改代码，仅审查
3. **逐项检查**
   - 按下方“审查清单”逐条对照，记录发现
   - 对非阻断问题标注为建议
4. **验证与推断**
   - 必要时推演关键路径、状态流转、边界条件
   - 可参考相邻逻辑/同类组件的实现约定
5. **输出报告**
   - 先列出问题（严重 > 警告 > 建议），再附可能的测试或验证步骤
   - 若未发现问题，明确说明并列出潜在风险/缺失的测试

---

## 审查清单

### 功能正确性

- 逻辑分支与状态流转覆盖正常流与异常流，边界条件明确（空数据、超时、并发）
- 入参/响应/事件契约与类型定义一致（Props/emit/返回值）
- 默认值、可选值与错误兜底合理；不可达分支或死代码已清理

### 错误处理与可观测性

- 异常捕获、防抖/节流/重试策略合理；不会吞掉错误
- 用户可感知的重要错误有提示，日志/console 未遗留调试输出

### 安全与数据

- 未暴露敏感信息（密钥、token、内部路径）；无硬编码秘密
- 输入/URL/渲染内容经过校验与转义，避免 XSS/注入
- 对外请求/重定向/文件读写经过权限或来源校验

### 前端/UX（Nuxt/Content/Docs 相关）

- 组件符合无障碍基本要求（语义元素、aria、焦点顺序/可达性）
- i18n：文案可翻译；未硬编码语言前缀；日期/数字/货币格式化正确
- 内容组件（MDC）使用合法；链接区分内/外链，避免语言前缀

### 结构与可维护性

- 代码可读、函数职责单一，避免重复；遵循现有模式与命名
- 依赖与配置变更透明（环境变量、构建配置、路由/权限）
- 类型覆盖充分；避免 `any`/宽松断言；SSR/CSR 环境差异已考虑

### 性能与资源

- 避免不必要的重渲染、昂贵计算、阻塞 I/O；懒加载/缓存策略合理
- 数据结构/迭代规模可接受；监听/计时器正确清理

### 测试与验证

- 现有测试是否需更新；新增逻辑的测试缺口（单测/e2e/可手测路径）
- 提供可执行的验证步骤或样例输入

---

## 输出格式

按严重度排序输出，精简但可操作：

```
❌ 严重
- [文件:行] 问题描述（影响/原因）→ 修复建议或示例

⚠️ 警告
- [文件:行] 问题描述 → 改进建议

💡 建议
- [文件] 优化点 → 可选改进

验证建议
- 推荐的手动/自动测试步骤或用例
```

要求：

- 若无发现：明确写“未发现问题”，并列出潜在风险/缺失测试
- 尽量给出定位信息（文件/行/函数）与可执行的修复路径
- 避免大段代码粘贴，必要时用最小示例
