import{r as e,C as l,M as a,O as t,z as i,L as n,Q as u,G as r,d as s,w as o,f as d,S as v,U as c,W as p,X as f,R as m,P as g,aZ as h,N as y,H as b,a0 as x,aa as k,y as K,E as S,aW as A,c as C,g as I,F as V,J as T,n as _,aX as w,e as j,an as E,t as B}from"./BOEjTd95.js";import{c as L}from"./BHswxmFj.js";import{t as W}from"./BY4ec_Pk.js";import $ from"./CNSUacam.js";import{M}from"./m8uzoPnc.js";import{u as R}from"./N5RumMeu.js";import{u as z}from"./DL4gl6Xz.js";import{f as P}from"./i8jAWLgi.js";import{_ as q}from"./DOW1UQBU.js";import{_ as O}from"./B1APjQ1Z.js";import"./wjg-Jxpu.js";function F(e){return e.reduce(((e,l)=>(e.push(l),l.children&&e.push(...F(l.children)),e)),[])}const[N,G]=n("TreeRoot"),H=l({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:e=>e.children},selectionBehavior:{default:"toggle"},multiple:{},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},bubbleSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(l,{emit:n}){const y=l,b=n,{items:x,multiple:k,disabled:K,propagateSelect:S,dir:A,bubbleSelect:C}=a(y),{handleTypeaheadSearch:I}=R(),V=z(A),T=e(),_=e(!1),w=u(),j=t(y,"modelValue",b,{defaultValue:y.defaultValue??(k.value?[]:void 0),passive:void 0===y.modelValue,deep:!0}),E=t(y,"expanded",b,{defaultValue:y.defaultExpanded??[],passive:void 0===y.expanded,deep:!0}),{onSelectItem:B,handleMultipleReplace:L}=function(l,a){const t=e();return{firstValue:t,onSelectItem:(e,i)=>{if(a.multiple&&Array.isArray(l.value))if("replace"===a.selectionBehavior)l.value=[e],t.value=e;else{const a=l.value.findIndex((e=>i(e)));l.value=-1!==a?l.value.filter(((e,l)=>l!==a)):[...l.value,e]}else"replace"===a.selectionBehavior?l.value={...e}:!Array.isArray(l.value)&&i(l.value)?l.value=void 0:l.value={...e};return l.value},handleMultipleReplace:function(e,i,n,u){var r;if(!(null==t?void 0:t.value)||!a.multiple||!Array.isArray(l.value))return;const s=null==(r=n().filter((e=>""!==e.ref.dataset.disabled)).find((e=>e.ref===i)))?void 0:r.value;if(!s)return;let o=null;switch(e){case"prev":case"next":o=P(u,t.value,s);break;case"first":o=P(u,t.value,null==u?void 0:u[0]);break;case"last":o=P(u,t.value,null==u?void 0:u[u.length-1])}l.value=o}}}(j,y),W=i((()=>k.value&&Array.isArray(j.value)?j.value.map((e=>y.getKey(e))):[y.getKey(j.value??{})]));function $(e,l=1,a){return e.reduce(((t,i,n)=>{const u=y.getKey(i),r=y.getChildren(i),s=E.value.includes(u),o={_id:u,value:i,index:n,level:l,parentItem:a,hasChildren:!!r,bind:{value:i,level:l,"aria-setsize":e.length,"aria-posinset":n+1}};return t.push(o),r&&s&&t.push(...$(r,l+1,i)),t}),[])}const O=i((()=>{const e=y.items;return E.value.map((e=>e)),$(e??[])}));function N(e){var l;if(_.value)w.trigger(e);else{const a=(null==(l=T.value)?void 0:l.getItems())??[];I(e.key,a)}}function H(e){if(_.value)return;const l=M[e.key];g((()=>{var e;L(l,h(),null==(e=T.value)?void 0:e.getItems,O.value.map((e=>e.value)))}))}function U(e){var l;if(null!=e.parentItem&&Array.isArray(j.value)&&y.multiple){const a=O.value.find((l=>null!=e.parentItem&&y.getKey(l.value)===y.getKey(e.parentItem)));if(null!=a){const e=null==(l=y.getChildren(a.value))?void 0:l.every((e=>j.value.find((l=>y.getKey(l)===y.getKey(e)))));j.value=e?[...j.value,a.value]:j.value.filter((e=>y.getKey(e)!==y.getKey(a.value))),U(a)}}}return G({modelValue:j,selectedKeys:W,onSelect:e=>{var l;const a=l=>y.getKey(l??{})===y.getKey(e),t=y.multiple&&Array.isArray(j.value)?-1!==(null==(l=j.value)?void 0:l.findIndex(a)):void 0;if(B(e,a),y.bubbleSelect&&y.multiple&&Array.isArray(j.value)){const l=O.value.find((l=>y.getKey(l.value)===y.getKey(e)));null!=l&&U(l)}if(y.propagateSelect&&y.multiple&&Array.isArray(j.value)){const l=F(y.getChildren(e)??[]);j.value=t?[...j.value].filter((e=>!l.some((l=>y.getKey(e??{})===y.getKey(l))))):[...j.value,...l]}},expanded:E,onToggle(e){if(!(e?y.getChildren(e):void 0))return;const l=y.getKey(e)??e;E.value.includes(l)?E.value=E.value.filter((e=>e!==l)):E.value.push(l)},getKey:y.getKey,getChildren:y.getChildren,items:x,expandedItems:O,disabled:K,multiple:k,dir:V,propagateSelect:S,bubbleSelect:C,isVirtual:_,virtualKeydownHook:w,handleMultipleReplace:L}),(e,l)=>(s(),r(v(q),{ref_key:"rovingFocusGroupRef",ref:T,"as-child":"",orientation:"vertical",dir:v(V)},{default:o((()=>[d(v(c),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!v(k)||void 0,onKeydown:[N,p(f(H,["shift"]),["up","down"])]},{default:o((()=>[m(e.$slots,"default",{flattenItems:O.value,modelValue:v(j),expanded:v(E)})])),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])])),_:3},8,["dir"]))}}),U=l({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(e,{expose:l,emit:a}){const t=e,n=a,u=N(),{getItems:g}=y(),k=i((()=>!!u.getChildren(t.value))),K=i((()=>{const e=u.getKey(t.value);return u.expanded.value.includes(e)})),S=i((()=>{const e=u.getKey(t.value);return u.selectedKeys.value.includes(e)})),A=i((()=>{if(u.bubbleSelect.value&&k.value&&Array.isArray(u.modelValue.value)){const e=F(u.getChildren(t.value)||[]);return e.some((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))&&!e.every((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))}if(u.propagateSelect.value&&S.value&&k.value&&Array.isArray(u.modelValue.value)){return!F(u.getChildren(t.value)||[]).every((e=>u.modelValue.value.find((l=>u.getKey(l)===u.getKey(e)))))}}));function C(e){if(k.value)if(K.value){const e=g().map((e=>e.ref)),l=h(),a=e.indexOf(l),i=[...e].slice(a).find((e=>Number(e.getAttribute("data-indent"))===t.level+1));i&&i.focus()}else w(e)}function I(e){if(K.value)w(e);else{const e=g().map((e=>e.ref)),l=h(),a=e.indexOf(l),i=[...e].slice(0,a).reverse().find((e=>Number(e.getAttribute("data-indent"))===t.level-1));i&&i.focus()}}async function V(e){n("select",e),(null==e?void 0:e.defaultPrevented)||u.onSelect(t.value)}async function T(e){n("toggle",e),(null==e?void 0:e.defaultPrevented)||u.onToggle(t.value)}async function _(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:K.value,isSelected:S.value};x("tree.select",V,l)}async function w(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:K.value,isSelected:S.value};x("tree.toggle",T,l)}return l({isExpanded:K,isSelected:S,isIndeterminate:A,handleToggle:()=>u.onToggle(t.value),handleSelect:()=>u.onSelect(t.value)}),(e,l)=>(s(),r(v(O),{"as-child":"",value:e.value,"allow-shift-key":""},{default:o((()=>[d(v(c),b(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":S.value,"aria-expanded":k.value?K.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":S.value?"":void 0,"data-expanded":K.value?"":void 0,onKeydown:[p(f(_,["self","prevent"]),["enter","space"]),l[0]||(l[0]=p(f((e=>"ltr"===v(u).dir.value?C(e):I(e)),["prevent"]),["right"])),l[1]||(l[1]=p(f((e=>"ltr"===v(u).dir.value?I(e):C(e)),["prevent"]),["left"]))],onClick:l[2]||(l[2]=f((e=>{_(e),w(e)}),["stop"]))}),{default:o((()=>[m(e.$slots,"default",{isExpanded:K.value,isSelected:S.value,isIndeterminate:A.value,handleSelect:()=>v(u).onSelect(e.value),handleToggle:()=>v(u).onToggle(e.value)})])),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])])),_:3},8,["value"]))}}),X={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},D={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(l){const a=l,t=k(),n=K(),[u,c]=L(),p=i((()=>{var e,l;return W({extend:W(X),...(null==(l=null==(e=n.uiPro)?void 0:e.prose)?void 0:l.codeTree)||{}})()})),f=e(a.defaultValue?{path:a.defaultValue}:void 0),m=e(),g=e(1),h=i((()=>{var e,l;return g.value,(null==(l=null==(e=t.default)?void 0:e.call(t))?void 0:l.flatMap(b).filter(Boolean))||[]})),y=i((()=>function(e){const l=new Map,a=[];e.forEach((e=>{const t=e.label.split("/");let i="";t.forEach(((e,n)=>{var u,r;if(i=i?`${i}/${e}`:e,!l.has(i)){const s={label:e,path:i,...n<t.length-1&&{children:[]}};l.set(i,s),0===n?a.push(s):null==(r=null==(u=l.get(t.slice(0,n).join("/")))?void 0:u.children)||r.push(s)}}))}));const t=e=>e.sort(((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1)).map((e=>({...e,children:e.children&&t(e.children)})));return t(a)}(h.value)));function b(e,l){var a,t,i,n;return"symbol"==typeof e.type?null==(a=e.children)?void 0:a.map(b):{label:(null==(t=e.props)?void 0:t.filename)||(null==(i=e.props)?void 0:i.label)||`${l}`,icon:null==(n=e.props)?void 0:n.icon,component:e}}const x=i((()=>{var e;if(a.expandAll){const e=new Set;return h.value.forEach((l=>{const a=l.label.split("/");for(let t=1;t<a.length;t++)e.add(a.slice(0,t).join("/"))})),Array.from(e)}const l=null==(e=f.value)?void 0:e.path;if(!l)return[];const t=l.split("/");return t.map(((e,l)=>t.slice(0,l+1).join("/")))}));return S(f,(e=>{const l=h.value.find((l=>(null==e?void 0:e.path)===l.label));(null==l?void 0:l.component)&&(m.value=l)}),{immediate:!0}),A((()=>g.value++)),(e,l)=>{var t,i,g,h;const b=E;return s(),C(V,null,[d(v(u),null,{default:o((({items:e,level:l})=>[(s(!0),C(V,null,T(e,((e,t)=>{var i,u;return s(),C("li",{key:`${l}-${t}`,class:_(l>0?p.value.itemWithChildren({class:null==(i=a.ui)?void 0:i.itemWithChildren}):p.value.item({class:null==(u=a.ui)?void 0:u.item}))},[d(v(U),{"as-child":"",level:l,value:e},{default:o((({isExpanded:t,isSelected:i})=>{var u,o,f,m,g,h,y,x,k,K;return[I("button",{class:_(p.value.link({class:null==(u=a.ui)?void 0:u.link,active:i}))},[(null==(o=e.children)?void 0:o.length)?(s(),r(b,{key:0,name:t?v(n).ui.icons.folderOpen:v(n).ui.icons.folder,class:_(p.value.linkLeadingIcon({class:null==(f=a.ui)?void 0:f.linkLeadingIcon}))},null,8,["name","class"])):(s(),r($,{key:1,filename:e.label,class:_(p.value.linkLeadingIcon({class:null==(m=a.ui)?void 0:m.linkLeadingIcon}))},null,8,["filename","class"])),I("span",{class:_(p.value.linkLabel({class:null==(g=a.ui)?void 0:g.linkLabel}))},B(e.label),3),(null==(h=e.children)?void 0:h.length)?(s(),C("span",{key:2,class:_(p.value.linkTrailing({class:null==(y=a.ui)?void 0:y.linkTrailing}))},[d(b,{name:v(n).ui.icons.chevronDown,class:_(p.value.linkTrailingIcon({class:null==(x=a.ui)?void 0:x.linkTrailingIcon}))},null,8,["name","class"])],2)):j("",!0)],2),(null==(k=e.children)?void 0:k.length)&&t?(s(),C("ul",{key:0,class:_(p.value.listWithChildren({class:null==(K=a.ui)?void 0:K.listWithChildren}))},[d(v(c),{items:e.children,level:l+1},null,8,["items","level"])],2)):j("",!0)]})),_:2},1032,["level","value"])],2)})),128))])),_:1}),I("div",{class:_(p.value.root({class:[null==(t=a.ui)?void 0:t.root,a.class]}))},[d(v(H),{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),class:_(p.value.list({class:null==(i=a.ui)?void 0:i.list})),items:y.value,"get-key":e=>e.path,"default-expanded":x.value},{default:o((()=>[d(v(c),{items:y.value,level:0},null,8,["items"])])),_:1},8,["modelValue","class","items","get-key","default-expanded"]),I("div",{class:_(p.value.content({class:null==(g=a.ui)?void 0:g.content}))},[(s(),r(w(null==(h=m.value)?void 0:h.component)))],2)],2)],64)}}};export{D as default};
