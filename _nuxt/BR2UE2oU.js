import{a0 as e,bT as l,Q as a,r as t,A as n,S as i,bP as u,I as r,bN as s,Z as d,D as o,e as v,w as c,g as f,H as p,b8 as m,a1 as g,a2 as h,E as y,Y as b,G as x,bU as k,ah as K,z as S,bt as A,aS as V,M as C,bL as I,d as T,h as w,F as _,O as E,n as L,bM as B,f as M,av as $,t as j}from"./DqFEFfH8.js";import W from"./CegXdHzB.js";import{_ as R,M as z,u as O,a as P}from"./7Yv3lObk.js";import{u as q}from"./B7Xd3CS8.js";function F(a){const t=e("",1e3);return{search:t,handleTypeaheadSearch:(e,a)=>{t.value=t.value+e;{const e=l(),n=a.map(e=>{var l,a;return{...e,textValue:(null==(l=e.value)?void 0:l.textValue)??(null==(a=e.ref.textContent)?void 0:a.trim())??""}}),i=n.find(l=>l.ref===e),u=function(e,l,a){const t=l.length>1&&Array.from(l).every(e=>e===l[0]),n=t?l[0]:l,i=a?e.indexOf(a):-1;let u=(r=e,s=Math.max(i,0),r.map((e,l)=>r[(s+l)%r.length]));var r,s;1===n.length&&(u=u.filter(e=>e!==a));const d=u.find(e=>e.toLowerCase().startsWith(n.toLowerCase()));return d!==a?d:void 0}(n.map(e=>e.textValue),t.value,null==i?void 0:i.textValue),r=n.find(e=>e.textValue===u);return r&&r.ref.focus(),null==r?void 0:r.ref}},resetTypeahead:()=>{t.value=""}}}function N(e,l,t){const n=e.findIndex(e=>a(e,l)),i=e.findIndex(e=>a(e,t));if(-1===n||-1===i)return[];const[u,r]=[n,i].sort((e,l)=>e-l);return e.slice(u,r+1)}function D(e){return e.reduce((e,l)=>(e.push(l),l.children&&e.push(...D(l.children)),e),[])}const[G,H]=s("TreeRoot"),U=n({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:e=>e.children},selectionBehavior:{default:"toggle"},multiple:{},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},bubbleSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(e,{emit:a}){const n=e,s=a,{items:x,multiple:k,disabled:K,propagateSelect:S,dir:A,bubbleSelect:V}=i(n),{handleTypeaheadSearch:C}=F(),I=q(A),T=t(),w=t(!1),_=d(),E=u(n,"modelValue",s,{defaultValue:n.defaultValue??(k.value?[]:void 0),passive:void 0===n.modelValue,deep:!0}),L=u(n,"expanded",s,{defaultValue:n.defaultExpanded??[],passive:void 0===n.expanded,deep:!0}),{onSelectItem:B,handleMultipleReplace:M}=function(e,l){const a=t();return{firstValue:a,onSelectItem:(t,n)=>{if(l.multiple&&Array.isArray(e.value))if("replace"===l.selectionBehavior)e.value=[t],a.value=t;else{const l=e.value.findIndex(e=>n(e));e.value=-1!==l?e.value.filter((e,a)=>a!==l):[...e.value,t]}else"replace"===l.selectionBehavior?e.value={...t}:!Array.isArray(e.value)&&n(e.value)?e.value=void 0:e.value={...t};return e.value},handleMultipleReplace:function(t,n,i,u){var r;if(!(null==a?void 0:a.value)||!l.multiple||!Array.isArray(e.value))return;const s=null==(r=i().filter(e=>""!==e.ref.dataset.disabled).find(e=>e.ref===n))?void 0:r.value;if(!s)return;let d=null;switch(t){case"prev":case"next":d=N(u,a.value,s);break;case"first":d=N(u,a.value,null==u?void 0:u[0]);break;case"last":d=N(u,a.value,null==u?void 0:u[u.length-1])}e.value=d}}}(E,n),$=r(()=>k.value&&Array.isArray(E.value)?E.value.map(e=>n.getKey(e)):[n.getKey(E.value??{})]);function j(e,l=1,a){return e.reduce((t,i,u)=>{const r=n.getKey(i),s=n.getChildren(i),d=L.value.includes(r),o={_id:r,value:i,index:u,level:l,parentItem:a,hasChildren:!!s,bind:{value:i,level:l,"aria-setsize":e.length,"aria-posinset":u+1}};return t.push(o),s&&d&&t.push(...j(s,l+1,i)),t},[])}const W=r(()=>{const e=n.items;return L.value.map(e=>e),j(e??[])});function O(e){var l;if(w.value)_.trigger(e);else{const a=(null==(l=T.value)?void 0:l.getItems())??[];C(e.key,a)}}function P(e){if(w.value)return;const a=z[e.key];b(()=>{var e;M(a,l(),null==(e=T.value)?void 0:e.getItems,W.value.map(e=>e.value))})}function G(e){var l;if(null!=e.parentItem&&Array.isArray(E.value)&&n.multiple){const a=W.value.find(l=>null!=e.parentItem&&n.getKey(l.value)===n.getKey(e.parentItem));if(null!=a){const e=null==(l=n.getChildren(a.value))?void 0:l.every(e=>E.value.find(l=>n.getKey(l)===n.getKey(e)));E.value=e?[...E.value,a.value]:E.value.filter(e=>n.getKey(e)!==n.getKey(a.value)),G(a)}}}return H({modelValue:E,selectedKeys:$,onSelect:e=>{var l;const a=l=>n.getKey(l??{})===n.getKey(e),t=n.multiple&&Array.isArray(E.value)?-1!==(null==(l=E.value)?void 0:l.findIndex(a)):void 0;if(B(e,a),n.bubbleSelect&&n.multiple&&Array.isArray(E.value)){const l=W.value.find(l=>n.getKey(l.value)===n.getKey(e));null!=l&&G(l)}if(n.propagateSelect&&n.multiple&&Array.isArray(E.value)){const l=D(n.getChildren(e)??[]);E.value=t?[...E.value].filter(e=>!l.some(l=>n.getKey(e??{})===n.getKey(l))):[...E.value,...l]}},expanded:L,onToggle(e){if(!(e?n.getChildren(e):void 0))return;const l=n.getKey(e)??e;L.value.includes(l)?L.value=L.value.filter(e=>e!==l):L.value.push(l)},getKey:n.getKey,getChildren:n.getChildren,items:x,expandedItems:W,disabled:K,multiple:k,dir:I,propagateSelect:S,bubbleSelect:V,isVirtual:w,virtualKeydownHook:_,handleMultipleReplace:M}),(e,l)=>(v(),o(p(R),{ref_key:"rovingFocusGroupRef",ref:T,"as-child":"",orientation:"vertical",dir:p(I)},{default:c(()=>[f(p(m),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!p(k)||void 0,onKeydown:[O,g(h(P,["shift"]),["up","down"])]},{default:c(()=>[y(e.$slots,"default",{flattenItems:W.value,modelValue:p(E),expanded:p(L)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Q=n({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(e,{expose:a,emit:t}){const n=e,i=t,u=G(),{getItems:s}=O(),d=r(()=>!!u.getChildren(n.value)),b=r(()=>{const e=u.getKey(n.value);return u.expanded.value.includes(e)}),K=r(()=>{const e=u.getKey(n.value);return u.selectedKeys.value.includes(e)}),S=r(()=>{if(u.bubbleSelect.value&&d.value&&Array.isArray(u.modelValue.value)){const e=D(u.getChildren(n.value)||[]);return e.some(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))&&!e.every(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))}if(u.propagateSelect.value&&K.value&&d.value&&Array.isArray(u.modelValue.value)){return!D(u.getChildren(n.value)||[]).every(e=>u.modelValue.value.find(l=>u.getKey(l)===u.getKey(e)))}});function A(e){if(d.value)if(b.value){const e=s().map(e=>e.ref),a=l(),t=e.indexOf(a),i=[...e].slice(t).find(e=>Number(e.getAttribute("data-indent"))===n.level+1);i&&i.focus()}else w(e)}function V(e){if(b.value)w(e);else{const e=s().map(e=>e.ref),a=l(),t=e.indexOf(a),i=[...e].slice(0,t).reverse().find(e=>Number(e.getAttribute("data-indent"))===n.level-1);i&&i.focus()}}async function C(e){i("select",e),(null==e?void 0:e.defaultPrevented)||u.onSelect(n.value)}async function I(e){i("toggle",e),(null==e?void 0:e.defaultPrevented)||u.onToggle(n.value)}async function T(e){if(!e)return;const l={originalEvent:e,value:n.value,isExpanded:b.value,isSelected:K.value};k("tree.select",C,l)}async function w(e){if(!e)return;const l={originalEvent:e,value:n.value,isExpanded:b.value,isSelected:K.value};k("tree.toggle",I,l)}return a({isExpanded:b,isSelected:K,isIndeterminate:S,handleToggle:()=>u.onToggle(n.value),handleSelect:()=>u.onSelect(n.value)}),(e,l)=>(v(),o(p(P),{"as-child":"",value:e.value,"allow-shift-key":""},{default:c(()=>[f(p(m),x(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":K.value,"aria-expanded":d.value?b.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":K.value?"":void 0,"data-expanded":b.value?"":void 0,onKeydown:[g(h(T,["self","prevent"]),["enter","space"]),l[0]||(l[0]=g(h(e=>"ltr"===p(u).dir.value?A(e):V(e),["prevent"]),["right"])),l[1]||(l[1]=g(h(e=>"ltr"===p(u).dir.value?V(e):A(e),["prevent"]),["left"]))],onClick:l[2]||(l[2]=h(e=>{T(e),w(e)},["stop"]))}),{default:c(()=>[y(e.$slots,"default",{isExpanded:b.value,isSelected:K.value,isIndeterminate:S.value,handleSelect:()=>p(u).onSelect(e.value),handleToggle:()=>p(u).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Y={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Z={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(e){const l=e,a=K(),n=S(),[i,u]=A(),s=r(()=>{var e,l;return V({extend:V(Y),...(null==(l=null==(e=n.uiPro)?void 0:e.prose)?void 0:l.codeTree)||{}})()}),d=t(l.defaultValue?{path:l.defaultValue}:void 0),m=t(),g=t(1),h=r(()=>{var e,l;return g.value,(null==(l=null==(e=a.default)?void 0:e.call(a))?void 0:l.flatMap(b).filter(Boolean))||[]}),y=r(()=>function(e){const l=new Map,a=[];e.forEach(e=>{const t=e.label.split("/");let n="";t.forEach((e,i)=>{var u,r;if(n=n?`${n}/${e}`:e,!l.has(n)){const s={label:e,path:n,...i<t.length-1&&{children:[]}};l.set(n,s),0===i?a.push(s):null==(r=null==(u=l.get(t.slice(0,i).join("/")))?void 0:u.children)||r.push(s)}})});const t=e=>e.sort((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1).map(e=>({...e,children:e.children&&t(e.children)}));return t(a)}(h.value));function b(e,l){var a,t,n,i;return"symbol"==typeof e.type?null==(a=e.children)?void 0:a.map(b):{label:(null==(t=e.props)?void 0:t.filename)||(null==(n=e.props)?void 0:n.label)||`${l}`,icon:null==(i=e.props)?void 0:i.icon,component:e}}const x=r(()=>{var e;if(l.expandAll){const e=new Set;return h.value.forEach(l=>{const a=l.label.split("/");for(let t=1;t<a.length;t++)e.add(a.slice(0,t).join("/"))}),Array.from(e)}const a=null==(e=d.value)?void 0:e.path;if(!a)return[];const t=a.split("/");return t.map((e,l)=>t.slice(0,l+1).join("/"))});return C(d,e=>{const l=h.value.find(l=>(null==e?void 0:e.path)===l.label);(null==l?void 0:l.component)&&(m.value=l)},{immediate:!0}),I(()=>g.value++),(e,a)=>{var t,r,g,h;const b=$;return v(),T(_,null,[f(p(i),null,{default:c(({items:e,level:a})=>[(v(!0),T(_,null,E(e,(e,t)=>{var i,r;return v(),T("li",{key:`${a}-${t}`,class:L(a>0?s.value.itemWithChildren({class:null==(i=l.ui)?void 0:i.itemWithChildren}):s.value.item({class:null==(r=l.ui)?void 0:r.item}))},[f(p(Q),{"as-child":"",level:a,value:e},{default:c(({isExpanded:t,isSelected:i})=>{var r,d,c,m,g,h,y,x,k,K;return[w("button",{class:L(s.value.link({class:null==(r=l.ui)?void 0:r.link,active:i}))},[(null==(d=e.children)?void 0:d.length)?(v(),o(b,{key:0,name:t?p(n).ui.icons.folderOpen:p(n).ui.icons.folder,class:L(s.value.linkLeadingIcon({class:null==(c=l.ui)?void 0:c.linkLeadingIcon}))},null,8,["name","class"])):(v(),o(W,{key:1,filename:e.label,class:L(s.value.linkLeadingIcon({class:null==(m=l.ui)?void 0:m.linkLeadingIcon}))},null,8,["filename","class"])),w("span",{class:L(s.value.linkLabel({class:null==(g=l.ui)?void 0:g.linkLabel}))},j(e.label),3),(null==(h=e.children)?void 0:h.length)?(v(),T("span",{key:2,class:L(s.value.linkTrailing({class:null==(y=l.ui)?void 0:y.linkTrailing}))},[f(b,{name:p(n).ui.icons.chevronDown,class:L(s.value.linkTrailingIcon({class:null==(x=l.ui)?void 0:x.linkTrailingIcon}))},null,8,["name","class"])],2)):M("",!0)],2),(null==(k=e.children)?void 0:k.length)&&t?(v(),T("ul",{key:0,class:L(s.value.listWithChildren({class:null==(K=l.ui)?void 0:K.listWithChildren}))},[f(p(u),{items:e.children,level:a+1},null,8,["items","level"])],2)):M("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),w("div",{class:L(s.value.root({class:[null==(t=l.ui)?void 0:t.root,l.class]}))},[f(p(U),{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),class:L(s.value.list({class:null==(r=l.ui)?void 0:r.list})),items:y.value,"get-key":e=>e.path,"default-expanded":x.value},{default:c(()=>[f(p(u),{items:y.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),w("div",{class:L(s.value.content({class:null==(g=l.ui)?void 0:g.content}))},[(v(),o(B(null==(h=m.value)?void 0:h.component)))],2)],2)],64)}}};export{Z as default};
