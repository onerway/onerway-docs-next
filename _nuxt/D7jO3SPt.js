import{r as e,D as l,M as a,O as t,P as i,Q as n,A as r,L as u,S as s,H as d,e as o,w as c,g as v,W as p,X as f,$ as g,a0 as m,U as y,bB as h,bC as b,R as x,bD as k,N as K,I as A,a5 as S,a8 as C,z as I,be as q,ae as V,G as T,bA as w,d as _,h as B,F as E,J as $,n as L,aZ as R,f as j,aq as W,t as M}from"#entry";import{f as z}from"./C3NS0hSO.js";import{R as O}from"./B60-lSj8.js";import F from"./6j61VbQ4.js";function N(e){return e.reduce((e,l)=>(e.push(l),l.children&&e.push(...N(l.children)),e),[])}const[P,D]=u("TreeRoot");var G=l({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:e=>e.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(l,{emit:u}){const K=l,A=u,{items:S,multiple:C,disabled:I,propagateSelect:q,dir:V,bubbleSelect:T}=a(K),{handleTypeaheadSearch:w}=t(),_=i(V),B=e(),E=e(!1),$=s(),L=n(K,"modelValue",A,{defaultValue:K.defaultValue??(C.value?[]:void 0),passive:!0,deep:!0}),R=n(K,"expanded",A,{defaultValue:K.defaultExpanded??[],passive:void 0===K.expanded,deep:!0}),{onSelectItem:j,handleMultipleReplace:W}=function(l,a){const t=e();return{firstValue:t,onSelectItem:(e,i)=>{if(a.multiple&&Array.isArray(l.value))if("replace"===a.selectionBehavior)l.value=[e],t.value=e;else{const a=l.value.findIndex(e=>i(e));l.value=-1!==a?l.value.filter((e,l)=>l!==a):[...l.value,e]}else"replace"===a.selectionBehavior?l.value={...e}:!Array.isArray(l.value)&&i(l.value)?l.value=void 0:l.value={...e};return l.value},handleMultipleReplace:function(e,i,n,r){if(!t?.value||!a.multiple||!Array.isArray(l.value))return;const u=n().filter(e=>""!==e.ref.dataset.disabled),s=u.find(e=>e.ref===i)?.value;if(!s)return;let d=null;switch(e){case"prev":case"next":d=z(r,t.value,s);break;case"first":d=z(r,t.value,r?.[0]);break;case"last":d=z(r,t.value,r?.[r.length-1])}l.value=d}}}(L,K),M=r(()=>C.value&&Array.isArray(L.value)?L.value.map(e=>K.getKey(e)):[K.getKey(L.value??{})]);function O(e,l=1,a){return e.reduce((t,i,n)=>{const r=K.getKey(i),u=K.getChildren(i),s=R.value.includes(r),d={_id:r,value:i,index:n,level:l,parentItem:a,hasChildren:!!u,bind:{value:i,level:l,"aria-setsize":e.length,"aria-posinset":n+1}};return t.push(d),u&&s&&t.push(...O(u,l+1,i)),t},[])}const F=r(()=>{const e=K.items;return R.value.map(e=>e),O(e??[])});function P(e){if(E.value)$.trigger(e);else{const l=B.value?.getItems()??[];w(e.key,l)}}function G(e){if(E.value)return;const l=b[e.key];x(()=>{W(l,k(),B.value?.getItems,F.value.map(e=>e.value))})}function H(e){if(null!=e.parentItem&&Array.isArray(L.value)&&K.multiple){const l=F.value.find(l=>null!=e.parentItem&&K.getKey(l.value)===K.getKey(e.parentItem));if(null!=l){const e=K.getChildren(l.value)?.every(e=>L.value.find(l=>K.getKey(l)===K.getKey(e)));L.value=e?[...L.value,l.value]:L.value.filter(e=>K.getKey(e)!==K.getKey(l.value)),H(l)}}}return D({modelValue:L,selectedKeys:M,onSelect:e=>{const l=l=>K.getKey(l??{})===K.getKey(e),a=K.multiple&&Array.isArray(L.value)?-1!==L.value?.findIndex(l):void 0;if(j(e,l),K.bubbleSelect&&K.multiple&&Array.isArray(L.value)){const l=F.value.find(l=>K.getKey(l.value)===K.getKey(e));null!=l&&H(l)}if(K.propagateSelect&&K.multiple&&Array.isArray(L.value)){const l=N(K.getChildren(e)??[]);L.value=a?[...L.value].filter(e=>!l.some(l=>K.getKey(e??{})===K.getKey(l))):[...L.value,...l]}},expanded:R,onToggle(e){if(!(e?K.getChildren(e):void 0))return;const l=K.getKey(e)??e;R.value.includes(l)?R.value=R.value.filter(e=>e!==l):R.value.push(l)},getKey:K.getKey,getChildren:K.getChildren,items:S,expandedItems:F,disabled:I,multiple:C,dir:_,propagateSelect:q,bubbleSelect:T,isVirtual:E,virtualKeydownHook:$,handleMultipleReplace:W}),(e,l)=>(o(),d(p(h),{ref_key:"rovingFocusGroupRef",ref:B,"as-child":"",orientation:"vertical",dir:p(_)},{default:c(()=>[v(p(f),{role:"tree",as:e.as,"as-child":e.asChild,"aria-multiselectable":!!p(C)||void 0,onKeydown:[P,g(m(G,["shift"]),["up","down"])]},{default:c(()=>[y(e.$slots,"default",{flattenItems:F.value,modelValue:p(L),expanded:p(R)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}});var H=l({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(e,{expose:l,emit:a}){const t=e,i=a,n=P(),{getItems:u}=K(),s=r(()=>!!n.getChildren(t.value)),h=r(()=>{const e=n.getKey(t.value);return n.expanded.value.includes(e)}),b=r(()=>{const e=n.getKey(t.value);return n.selectedKeys.value.includes(e)}),x=r(()=>{if(n.bubbleSelect.value&&s.value&&Array.isArray(n.modelValue.value)){const e=N(n.getChildren(t.value)||[]);return e.some(e=>n.modelValue.value.find(l=>n.getKey(l)===n.getKey(e)))&&!e.every(e=>n.modelValue.value.find(l=>n.getKey(l)===n.getKey(e)))}if(n.propagateSelect.value&&b.value&&s.value&&Array.isArray(n.modelValue.value)){return!N(n.getChildren(t.value)||[]).every(e=>n.modelValue.value.find(l=>n.getKey(l)===n.getKey(e)))}});function C(e){if(s.value)if(h.value){const e=u().map(e=>e.ref),l=k(),a=e.indexOf(l),i=[...e].slice(a).find(e=>Number(e.getAttribute("data-indent"))===t.level+1);i&&i.focus()}else w(e)}function I(e){if(h.value)w(e);else{const e=u().map(e=>e.ref),l=k(),a=e.indexOf(l),i=[...e].slice(0,a).reverse().find(e=>Number(e.getAttribute("data-indent"))===t.level-1);i&&i.focus()}}async function q(e){i("select",e),e?.defaultPrevented||n.onSelect(t.value)}async function V(e){i("toggle",e),e?.defaultPrevented||n.onToggle(t.value)}async function T(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:h.value,isSelected:b.value};S("tree.select",q,l)}async function w(e){if(!e)return;const l={originalEvent:e,value:t.value,isExpanded:h.value,isSelected:b.value};S("tree.toggle",V,l)}return l({isExpanded:h,isSelected:b,isIndeterminate:x,handleToggle:()=>n.onToggle(t.value),handleSelect:()=>n.onSelect(t.value)}),(e,l)=>(o(),d(p(O),{"as-child":"",value:e.value,"allow-shift-key":""},{default:c(()=>[v(p(f),A(e.$attrs,{role:"treeitem",as:e.as,"as-child":e.asChild,"aria-selected":b.value,"aria-expanded":s.value?h.value:void 0,"aria-level":e.level,"data-indent":e.level,"data-selected":b.value?"":void 0,"data-expanded":h.value?"":void 0,onKeydown:[g(m(T,["self","prevent"]),["enter","space"]),l[0]||(l[0]=g(m(e=>"ltr"===p(n).dir.value?C(e):I(e),["prevent"]),["right"])),l[1]||(l[1]=g(m(e=>"ltr"===p(n).dir.value?I(e):C(e),["prevent"]),["left"]))],onClick:l[2]||(l[2]=m(e=>{T(e),w(e)},["stop"]))}),{default:c(()=>[y(e.$slots,"default",{isExpanded:h.value,isSelected:b.value,isIndeterminate:x.value,handleSelect:()=>p(n).onSelect(e.value),handleToggle:()=>p(n).onToggle(e.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}});const U={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},J=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(l){const a=l,t=C(),i=I(),[n,u]=q(),s=r(()=>V({extend:V(U),...i.ui?.prose?.codeTree||{}})()),f=e(a.defaultValue?{path:a.defaultValue}:void 0),g=e(),m=e(1),y=r(()=>(m.value,t.default?.()?.flatMap(b).filter(Boolean)||[])),h=r(()=>function(e){const l=new Map,a=[];e.forEach(e=>{const t=e.label.split("/");let i="";t.forEach((e,n)=>{if(i=i?`${i}/${e}`:e,!l.has(i)){const r={label:e,path:i,...n<t.length-1&&{children:[]}};l.set(i,r),0===n?a.push(r):l.get(t.slice(0,n).join("/"))?.children?.push(r)}})});const t=e=>e.sort((e,l)=>!!e.children==!!l.children?e.label.localeCompare(l.label):l.children?1:-1).map(e=>({...e,children:e.children&&t(e.children)}));return t(a)}(y.value));function b(e,l){return"symbol"==typeof e.type?e.children?.map(b):{label:e.props?.filename||e.props?.label||`${l}`,icon:e.props?.icon,component:e}}const x=r(()=>{if(a.expandAll){const e=new Set;return y.value.forEach(l=>{const a=l.label.split("/");for(let t=1;t<a.length;t++)e.add(a.slice(0,t).join("/"))}),Array.from(e)}const e=f.value?.path;if(!e)return[];const l=e.split("/");return l.map((e,a)=>l.slice(0,a+1).join("/"))});return T(f,e=>{const l=y.value.find(l=>e?.path===l.label);l?.component&&(g.value=l)},{immediate:!0}),w(()=>m.value++),(e,l)=>(o(),_(E,null,[v(p(n),null,{default:c(({items:e,level:l})=>[(o(!0),_(E,null,$(e,(e,t)=>(o(),_("li",{key:`${l}-${t}`,class:L(l>0?s.value.itemWithChildren({class:a.ui?.itemWithChildren}):s.value.item({class:a.ui?.item}))},[v(p(H),{"as-child":"",level:l,value:e},{default:c(({isExpanded:t,isSelected:n})=>[B("button",{class:L(s.value.link({class:a.ui?.link,active:n}))},[e.children?.length?(o(),d(W,{key:0,name:t?p(i).ui.icons.folderOpen:p(i).ui.icons.folder,class:L(s.value.linkLeadingIcon({class:a.ui?.linkLeadingIcon}))},null,8,["name","class"])):(o(),d(F,{key:1,filename:e.label,class:L(s.value.linkLeadingIcon({class:a.ui?.linkLeadingIcon}))},null,8,["filename","class"])),B("span",{class:L(s.value.linkLabel({class:a.ui?.linkLabel}))},M(e.label),3),e.children?.length?(o(),_("span",{key:2,class:L(s.value.linkTrailing({class:a.ui?.linkTrailing}))},[v(W,{name:p(i).ui.icons.chevronDown,class:L(s.value.linkTrailingIcon({class:a.ui?.linkTrailingIcon}))},null,8,["name","class"])],2)):j("",!0)],2),e.children?.length&&t?(o(),_("ul",{key:0,class:L(s.value.listWithChildren({class:a.ui?.listWithChildren}))},[v(p(u),{items:e.children,level:l+1},null,8,["items","level"])],2)):j("",!0)]),_:2},1032,["level","value"])],2))),128))]),_:1}),B("div",A(e.$attrs,{class:s.value.root({class:[a.ui?.root,a.class]})}),[v(p(G),{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),class:L(s.value.list({class:a.ui?.list})),items:h.value,"get-key":e=>e.path,"default-expanded":x.value},{default:c(()=>[v(p(u),{items:h.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),B("div",{class:L(s.value.content({class:a.ui?.content}))},[(o(),d(R(g.value?.component)))],2)],16)],64))}});export{J as default};
