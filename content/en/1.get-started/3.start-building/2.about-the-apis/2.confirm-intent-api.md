---
title: Confirm Intent API
description: Learn more about the Onerway API for confirming payment intents using productType, subProductType, and txnType parameters.
draft: true
stripeDocUrl: https://docs.stripe.com/payments/setup-intents
---

## Learn More About Onerway API Confirm Payment Intent

在创建支付方式时，需要明确具体的支付场景，例如：卡信息留存、订阅扣款、数字钱包支付等。Onerway 通过 `productType`、`subProductType`、`txnType` 三个参数组合来定义支付意图（Payment Intent）。

## ProductType - Product Type

`productType` 是定义支付意图的核心参数，用于指定商户希望使用的支付产品类型。通过该参数，系统能够识别并加载相应的支付场景和交互流程。

### Supported Product Types

#### CARD - Card Payment

适用于信用卡/借记卡支付场景，支持国际卡网络（Visa、Mastercard、Amex 等）。

**典型应用场景：**

- 在线购物结账
- 订阅服务扣款
- 卡信息留存（Card on File）
- 分期付款（Installment）

**支持的支付模式（subProductType）：** DIRECT（直连）、TOKEN（令牌化）、SUBSCRIBE（订阅）、INSTALLMENT（分期）

#### LPMS - Local Payment Methods

适用于特定地区的本地化支付方式，如支付宝、微信支付等。

**典型应用场景：**

- 地区性电子钱包支付
- 本地化收银场景

**支持的支付模式（subProductType）：** 通常与 DIRECT 模式配合使用

#### PAYMENT_CODE - Merchant Scan

商户主动扫描顾客的付款码完成交易，常见于线下收银场景。

**典型应用场景：**

- 超市/便利店收银台
- 餐饮门店结账
- 线下零售 POS 收款

**交互流程：** 顾客出示付款码 → 商户扫描 → 完成支付

::callout{type="warning"}
注意：目前仅 Alipay 支持此场景
::

#### ORDER_CODE - Customer Scan

顾客扫描商户提供的订单二维码完成支付，适用于订单支付场景。

**典型应用场景：**

- 餐桌点餐支付
- 自助售货机
- 账单支付

**交互流程：** 商户生成订单码 → 顾客扫描 → 完成支付

::callout{type="warning"}
注意：目前仅 Alipay 支持此场景
::

### How to Choose ProductType?

| 业务场景 | 推荐类型 | 说明 |
|----------|----------|------|
| 跨境电商、国际业务 | **CARD** | 支持国际卡网络，覆盖全球用户 |
| 了解当地支付习惯 | **LPMS** | 在某些国家顾客常用的当地支付方式，如：微信、支付宝等 |
| 线下门店收银 | **PAYMENT_CODE** | 商户扫顾客付款码，快速结账 |
| 自助设备/账单支付 | **ORDER_CODE** | 顾客扫商户订单码，无需人工 |

::callout{type="warning"}
注意：使用 `productType: "ALL"` 请求托管页面时，Onerway 将返回聚合支付页面，该页面会根据商户账户配置，自动展示所有已启用的支付方式供用户选择。
::

## SubProductType - Sub Product Type

`subProductType` 是定义支付意图的关键参数，用于明确具体的支付处理方式和业务模式。它与 `productType` 配合使用，精确描述商户希望实现的支付场景。

### Supported Sub Product Types

#### DIRECT - Direct Payment

最常见的支付方式，顾客直接完成当前交易的支付，资金实时处理。

**常见组合：**

```json
// Card Direct Payment
"productType": "CARD",
"subProductType": "DIRECT"

// Local Payment Methods
"productType": "LPMS",
"subProductType": "DIRECT"
```

#### TOKEN - Tokenized Payment

将敏感的卡信息转换为安全令牌（Token）进行存储和使用，提升支付安全性。

**业务流程：**

1. 首次支付时生成 Token
2. 系统保存 Token（非真实卡号）
3. 后续支付使用 Token 完成交易

**常见组合：**

```json
// Card on File
"productType": "CARD",
"subProductType": "TOKEN"
```

#### SUBSCRIBE - Subscription Payment

用于周期性自动扣款的订阅业务，系统按约定周期自动发起扣款。

**业务流程：**

1. 顾客首次授权订阅
2. 系统保存支付凭证
3. 商家可按周期发起扣款/自动扣款
4. 顾客可随时取消订阅

**常见组合：**

```json
// Subscription Payment
"productType": "CARD",
"subProductType": "SUBSCRIBE"
```

#### INSTALLMENT - Installment Payment

将订单金额拆分为多期进行支付，降低顾客单次支付压力。

**业务流程：**

1. 顾客选择分期期数
2. 系统计算每期金额
3. 首期立即扣款
4. 后续按期自动扣款

**常见组合：**

```json
// Installment Payment
"productType": "CARD",
"subProductType": "INSTALLMENT"
```

### How to Choose SubProductType?

| 业务需求 | 推荐类型 | 核心价值 |
|----------|----------|----------|
| 普通单次支付 | **DIRECT** | 简单直接，实时到账 |
| 需要保存卡信息 | **TOKEN** | 安全合规，快捷支付 |
| 周期性扣款业务 | **SUBSCRIBE** | 自动续费，提升留存 |
| 大额商品销售 | **INSTALLMENT** | 降低门槛，提升转化 |

### Relationship with ProductType

不同的 `productType` 支持的 `subProductType` 有所不同：

| ProductType | 支持的 SubProductType | 说明 |
|-------------|----------------------|------|
| **CARD** | DIRECT, TOKEN, SUBSCRIBE, INSTALLMENT | 卡支付支持所有子类型 |
| **LPMS** | DIRECT, SUBSCRIBE | 本地支付通常仅支持直连，少数钱包支持订阅 |
| **PAYMENT_CODE** | DIRECT | 商户扫码仅支持直连 |
| **ORDER_CODE** | DIRECT | 顾客扫码仅支持直连 |

## txnType - Transaction Type

`txnType` 用于指定交易类型，决定本次支付请求的业务处理方式。不同的交易类型对应不同的资金处理流程。

### Supported Transaction Types

#### SALE - Standard Transaction

最常见的支付类型，顾客直接完成当前交易的支付，资金实时处理。

**常见组合：**

```json
// Card Direct Payment
"productType": "CARD",
"subProductType": "DIRECT",
"txnType": "SALE"

// Local Payment Methods
"productType": "LPMS",
"subProductType": "DIRECT",
"txnType": "SALE"
```

#### REFUND - Refund Transaction

Onerway 建议将 SALE 看作正向交易，那么 REFUND 就是反向交易。当顾客对某一笔正向交易发起退款时产生。

**查询 API 或 Webhook 通知时：**

```json
"txnType": "REFUND"
```

#### BIND_CARD - Save Card Transaction

BIND_CARD 用于保存顾客的银行卡信息，不进行实际扣款，方便后续快速支付。

**查询 API 或 Webhook 通知时：**

```json
"txnType": "BIND_CARD"
```

#### AUTH, CAPTURE, VOID - Pre-authorization Transactions

授权支付是**预留资金但不实际扣款**的支付方式，也称为"预授权"或"手动捕获"。

### How It Works

1. **授权（AUTH）**：冻结客户账户中的资金

```json
"txnType": "AUTH"
```

2. **捕获（CAPTURE）**：在有效期内实际扣款

```json
"txnType": "CAPTURE"
```

3. **撤销（VOID）**：撤销已经授权的交易，资金释放

```json
"txnType": "VOID"
```

4. **过期释放**：超时未捕获则自动释放资金。有效期最长 7 天，商户需要在后台进行配置。

::callout{type="info"}
注意：对于一些在移动端可以直接拉起应用付款的钱包，如：WeChatPay、Dana 等，还需要上送 `paymentMode`、`osType`。详情可查看 [本地支付](https://docs.onerway.com/apis/zh/v0.6/local-payment)
::

**WeChatPay Example：**

```json
"productType": "LPMS",
"subProductType": "DIRECT",
"txnType": "SALE",
"paymentMode": "IN_APP",
"osType": "IOS",
"lpmsInfo": "{\"lpmsType\":\"WeChat\"}"
```

**Dana Example：**

```json
"productType": "LPMS",
"subProductType": "DIRECT",
"txnType": "SALE",
"paymentMode": "IN_APP",
"osType": "IOS",
"lpmsInfo": "{\"lpmsType\":\"DANA\"}"
```

