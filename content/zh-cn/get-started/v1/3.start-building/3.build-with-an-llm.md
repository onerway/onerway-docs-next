---
title: 使用 LLM 构建
description: 利用 AI 与大语言模型加速你的 Onerway 集成开发
order: 3
showToc: true
showNavigation: true
---

## AI 驱动的开发

借助 AI，可以显著提升你的集成开发效率。
本指南展示如何利用大型语言模型（LLM），如 ChatGPT、Claude 或 GitHub Copilot，更快更好地构建 Onerway 集成。

## 快速开始

### **1. AI 生成集成代码**

使用 AI 为常见集成场景生成样板代码：

**提示示例：**

```
Generate a Node.js Express server that integrates with Onerway payments API.
Include endpoints for creating payment intents, handling webhooks, and processing refunds.
Use proper error handling and security best practices.
```

**生成的代码：**

```javascript
const express = require("express");
const onerway = require("@onerway/onerway-js");
const app = express();

// Initialize Onerway with your secret key
const onerway = require("@onerway/onerway-js")(
  process.env.ONERWAY_SECRET_KEY
);

app.use(express.json());

// Create payment intent endpoint
app.post("/create-payment-intent", async (req, res) => {
  try {
    const { amount, currency, customer } = req.body;

    const paymentIntent =
      await onerway.paymentIntents.create({
        amount: amount * 100, // Convert to cents
        currency,
        customer,
        automatic_payment_methods: { enabled: true },
      });

    res.json({ clientSecret: paymentIntent.client_secret });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// Webhook handler
app.post(
  "/webhook",
  express.raw({ type: "application/json" }),
  (req, res) => {
    const sig = req.headers["onerway-signature"];

    try {
      const event = onerway.webhooks.constructEvent(
        req.body,
        sig,
        process.env.ONERWAY_WEBHOOK_SECRET
      );

      switch (event.type) {
        case "payment_intent.succeeded":
          console.log(
            "Payment succeeded:",
            event.data.object.id
          );
          break;
        default:
          console.log(
            `Unhandled event type: ${event.type}`
          );
      }

      res.json({ received: true });
    } catch (err) {
      res.status(400).send(`Webhook Error: ${err.message}`);
    }
  }
);

app.listen(3000, () =>
  console.log("Server running on port 3000")
);
```

### **2. AI 代码评审**

让 AI 审查你的集成代码：

**提示示例：**

```
Review this Onerway payment integration code for security issues,
best practices, and potential improvements:

[Your code here]
```

### **3. AI 文档助手**

从代码生成文档：

**提示示例：**

```
Create API documentation for this Onerway integration endpoint,
including request/response examples, error codes, and usage notes:

[Your endpoint code here]
```

## AI 开发工作流

### **🚀 快速原型工作流**

1. 向 AI 描述你的用例
2. 生成初始代码结构
3. 根据具体需求迭代完善
4. 补充错误处理与安全
5. 生成测试

#### 示例：电商集成

```
Prompt: "Create a complete e-commerce checkout flow using Onerway that handles:
- Product selection and cart management
- Customer registration/login
- Payment processing with saved payment methods
- Order confirmation and receipt generation
- Webhook handling for payment status updates"
```

### **🔍 代码分析工作流**

1. 将现有代码提供给 AI
2. 提出具体分析诉求（安全、性能、最佳实践）
3. 获取改进建议
4. 实施建议
5. 通过 AI 复核

### **📝 文档工作流**

1. 从代码生成 API 文档
2. 为不同用例创建集成指南
3. 基于常见问题构建排障指南
4. 生成多语言代码示例

## AI 协助的集成模式

### **订阅管理**

**AI 提示：**

```
Create a subscription management system using Onerway that handles:
- Recurring billing setup
- Plan upgrades/downgrades
- Failed payment retry logic
- Subscription cancellation
- Proration calculations
```

**生成模式：**

```javascript
class SubscriptionManager {
  constructor(onerway) {
    this.onerway = onerway;
  }

  async createSubscription(customerId, priceId) {
    try {
      const subscription =
        await this.onerway.subscriptions.create({
          customer: customerId,
          items: [{ price: priceId }],
          payment_behavior: "default_incomplete",
          payment_settings: {
            save_default_payment_method: "on_subscription",
          },
          expand: ["latest_invoice.payment_intent"],
        });

      return {
        subscriptionId: subscription.id,
        clientSecret:
          subscription.latest_invoice.payment_intent
            .client_secret,
      };
    } catch (error) {
      throw new Error(
        `Subscription creation failed: ${error.message}`
      );
    }
  }

  async upgradeSubscription(subscriptionId, newPriceId) {
    const subscription =
      await this.onerway.subscriptions.retrieve(
        subscriptionId
      );

    return await this.onerway.subscriptions.update(
      subscriptionId,
      {
        items: [
          {
            id: subscription.items.data[0].id,
            price: newPriceId,
          },
        ],
        proration_behavior: "always_invoice",
      }
    );
  }
}
```

### **多方支付（平台/市场）**

**AI 提示：**

```
Build a marketplace payment system that:
- Splits payments between platform and vendors
- Handles platform fees
- Manages vendor payouts
- Supports refunds and disputes
```

### **国际化支付**

**AI 提示：**

```
Create an international payment system that:
- Supports multiple currencies
- Handles currency conversion
- Manages local payment methods
- Complies with regional regulations
```

## Onerway 开发者的 AI 工具

### **GitHub Copilot**

- 实时代码建议
- 具备上下文的补全
- 针对集成的模式化建议

```javascript
// Type comment, Copilot suggests implementation
// Create a Onerway customer with payment method
const customer = await onerway.customers.create({
  email: customerEmail,
  payment_method: paymentMethodId,
  invoice_settings: {
    default_payment_method: paymentMethodId,
  },
});
```

### **ChatGPT / Claude 集成**

- 代码生成与评审
- 架构规划
- 问题求解

### **Cursor AI**

- 智能代码编辑
- 重构辅助
- Bug 检测与修复

### **自定义 AI 助手**

基于 Onerway 文档训练的专用助手：

```python
# Example: Custom Onerway AI Assistant
import openai

class OnerwayAssistant:
    def __init__(self, api_key):
        self.client = openai.OpenAI(api_key=api_key)
        self.system_prompt = """
        You are an expert Onerway integration developer.
        Help developers build secure, efficient payment integrations.
        Always include error handling and follow Onerway best practices.
        """

    def get_integration_help(self, user_question):
        response = self.client.chat.completions.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": self.system_prompt},
                {"role": "user", "content": user_question}
            ]
        )
        return response.choices[0].message.content
```

## AI 生成的测试

### **单元测试**

**提示：**

```
Generate comprehensive unit tests for this Onerway payment handler including:
- Successful payment scenarios
- Error conditions
- Edge cases
- Mock implementations
```

**生成的测试：**

```javascript
const request = require("supertest");
const app = require("../app");
const onerway = require("@onerway/onerway-js");

// Mock Onerway
jest.mock("@onerway/onerway-js");

describe("Payment Endpoints", () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe("POST /create-payment-intent", () => {
    it("should create payment intent successfully", async () => {
      const mockPaymentIntent = {
        id: "pi_test_123",
        client_secret: "pi_test_123_secret_test",
      };

      onerway.paymentIntents.create.mockResolvedValue(
        mockPaymentIntent
      );

      const response = await request(app)
        .post("/create-payment-intent")
        .send({
          amount: 2000,
          currency: "usd",
        });

      expect(response.status).toBe(200);
      expect(response.body.clientSecret).toBe(
        mockPaymentIntent.client_secret
      );
    });

    it("should handle payment creation errors", async () => {
      onerway.paymentIntents.create.mockRejectedValue(
        new Error("Invalid amount")
      );

      const response = await request(app)
        .post("/create-payment-intent")
        .send({
          amount: -100,
          currency: "usd",
        });

      expect(response.status).toBe(500);
      expect(response.body.error).toBe("Invalid amount");
    });
  });
});
```

### **集成测试**

生成端到端的完整支付流程测试场景。

## AI 协作最佳实践

### **🔒 安全**

- 对 AI 生成代码进行安全审查
- 审核 API Key 的处理与存储
- 校验 Webhook 签名验证实现
- 确保错误处理不暴露敏感信息

### **✅ 代码质量**

- 在提示中明确编码规范
- 要求 TypeScript 定义
- 补充完善的错误处理
- 要求给出必要注释

### **🧪 测试策略**

- 与实现同步生成测试
- 覆盖边界条件与错误场景
- 构造模拟数据与响应
- 完整测试 Webhook 处理

### **📚 文档**

- 生成行内注释
- 编写集成的 README
- 构建 API 文档
- 形成排障指南

## 进阶技巧

### **面向 Onerway 的微调**

在 Onerway 场景与文档上进行定制训练。

### **RAG（检索增强生成）**

结合实时检索 Onerway 文档的能力。

### **代码分析流水线**

自动化进行代码审查与安全扫描。

## 示例提示库

### **集成搭建**

```
Create a production-ready Onerway integration for [use case] that includes:
- Environment configuration
- Error handling
- Security best practices
- Webhook processing
- Testing framework
```

### **调试助手**

```
Debug this Onerway integration error: [error message]
Code context: [relevant code]
Expected behavior: [description]
```

### **性能优化**

```
Optimize this Onerway integration for high-volume transactions:
[current code]
Target: Handle 1000+ payments per minute with proper rate limiting
```

## 下一步

准备好用 AI 提速你的开发了吗？

1. 🚀 [开始开发](../start-developing) —— 配置开发环境
2. 🔍 [关于 API](../mock/about-the-apis) —— 理解 API 结构
3. 🎯 [无代码使用](../use-stripe-without-code) —— 探索无代码选项
4. 📚 [支付文档](../../../payments/) —— 深入理解支付

## 资源

- 🤖 [AI 开发模板](https://github.com/onerway/ai-templates) —— 即用型提示词
- 🔧 [GitHub Copilot 指南](../../../guides/github-copilot) —— 更好地使用 Copilot
- 📖 [AI 最佳实践](../../../guides/ai-development) —— 安全与质量指南
- 💬 [AI 开发者社区](https://community.onerway.com/ai) —— 交流分享

对 AI 开发有问题？
[加入我们的 AI 开发者讨论](https://community.onerway.com/ai)。


