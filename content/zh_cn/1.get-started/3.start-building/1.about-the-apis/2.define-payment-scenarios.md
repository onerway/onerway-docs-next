---
title: 定义支付场景
description: 了解如何通过 productType、subProductType 和 txnType 参数配置支付流程。
draft: true
---

通过组合三个参数来定义支付场景：`productType`、`subProductType` 和 `txnType`。这些参数告诉 Onerway 使用哪种支付产品、如何处理支付以及执行什么资金流向。

| 参数 | 用途 | 示例 |
|------|------|------|
| `productType` | 支付产品 | 银行卡、本地支付方式、二维码 |
| `subProductType` | 支付模式 | 直接支付、令牌化、订阅、分期 |
| `txnType` | 交易类型 | 销售、退款、预授权、扣款 |

## 选择产品类型

`productType` 参数指定使用哪种支付产品。它决定了支付流程和可用的支付方式。

::prose-accordion
---
type: multiple
defaultValue: ["0", "1"]
---

  :::prose-accordion-item{icon="i-lucide-credit-card" badge="CARD"}

  #label
  ### 银行卡支付

  #content
  接受国际卡组织的信用卡和借记卡，包括 Visa、Mastercard 和 American Express。

  适用场景：在线结账、定期订阅、保存卡片、分期付款。

  兼容模式：`DIRECT`、`TOKEN`、`SUBSCRIBE`、`INSTALLMENT`。
  :::

  :::prose-accordion-item{icon="i-lucide-wallet" badge="LPMS"}

  #label
  ### 本地支付方式

  #content
  接受特定地区流行的支付方式，如支付宝、微信支付和其他数字钱包。

  适用场景：服务本地客户、提供熟悉的支付选项、减少支付摩擦。

  兼容模式：`DIRECT`、`SUBSCRIBE`。

    ::::note
    可用的本地支付方式取决于您的账户配置和地理区域。
    ::::
  :::

  :::prose-accordion-item{icon="i-lucide-scan-line" badge="Payment code"}

  #label
  ### 商户扫码

  #content
  客户出示付款码，由您扫描以收款。常用于线下零售场景。

  适用场景：POS 系统、零售收银台、餐厅结账

  工作流程：
  1. 客户打开支付 App 并出示付款码
  2. 您使用终端或设备扫描该付款码
  3. 支付即时完成

  兼容模式：仅 `DIRECT`

    ::::warning
    目前仅支持支付宝。
    ::::
  :::

  :::prose-accordion-item{icon="i-lucide-qr-code" badge="Order code"}

  #label
  ### 客户扫码

  #content
  您生成订单二维码，客户扫描后完成支付。无需商户交互。

  适用场景：自助服务终端、桌边点餐、账单支付、自动售货机

  工作流程：
  1. 您的系统生成订单专属二维码
  2. 客户用支付 App 扫描该二维码
  3. 客户在 App 内完成支付
  4. 您收到支付确认通知

  兼容模式：仅 `DIRECT`

    ::::warning
    目前仅支持支付宝。
    ::::
  :::
::

### 产品类型选择指南

| 如果您的业务... | 使用 | 原因 |
|----------------|------|------|
| 服务国际客户或开展跨境业务 | `CARD` | 支持全球卡组织 |
| 在本地支付偏好强烈的地区运营 | `LPMS` | 提供微信支付等熟悉的选项 |
| 拥有线下零售门店 | `PAYMENT_CODE` | 快速完成面对面结账 |
| 使用自助终端或无人零售 | `ORDER_CODE` | 客户无需工作人员即可支付 |

::tip
设置 `productType: "ALL"` 可显示包含所有已启用支付方式的聚合收银页面。
::

## 选择支付模式

`subProductType` 参数指定支付模式和处理方式。它与 `productType` 配合使用，精确描述支付场景。

::prose-accordion
---
type: multiple
defaultValue: ["0", "1", "2", "3"]
---

  :::prose-accordion-item{icon="i-lucide-zap" badge="DIRECT"}

  #label
  ### 直接支付

  #content
  处理即时的一次性支付。客户完成交易时实时扣款。

  适用场景：标准电商结账、一次性购买、即时收款。

    ::::prose-tabs{variant="pill" sync="product-type"}
      :::::prose-tabs-item{label="银行卡" value="card" icon="i-lucide-credit-card"}
      ```json
      {
        "productType": "CARD",
        "subProductType": "DIRECT"
      }
      ```
      :::::

      :::::prose-tabs-item{label="本地支付" value="lpms" icon="i-lucide-wallet"}
      将 `WeChat` 替换为实际的支付方式类型（如 `Alipay`、`DANA`）：

      ```json
      {
        "lpmsInfo": "{\"lpmsType\":\"WeChat\"}",
        "productType": "LPMS",
        "subProductType": "DIRECT"
      }
      ```
      :::::
    ::::
  :::

  :::prose-accordion-item{icon="i-lucide-key" badge="TOKEN"}

  #label
  ### 令牌化支付

  #content
  将敏感卡片信息保存为安全令牌以供后续使用。令牌化通过存储占位符而非实际卡片详情来增强安全性。

  适用场景：保存客户的支付方式，实现更快的结账体验，无需重复输入卡片信息。

  ```json
  {
    "productType": "CARD",
    "subProductType": "TOKEN"
  }
  ```

    ::::note
    令牌化可降低您的 PCI（支付卡行业）合规范围，因为您永远不会存储实际卡号。
    ::::
  :::

  :::prose-accordion-item{icon="i-lucide-repeat" badge="SUBSCRIBE"}

  #label
  ### 订阅支付

  #content
  为订阅制业务启用定期自动扣款。Onerway 根据您定义的账单周期发起扣款。

  适用场景：SaaS 订阅、会员费、定期服务、自动续费。

  `subscription` 字段包含指定订阅详情的 JSON 字符串：

  ```json
  {
    "productType": "CARD",
    "subProductType": "SUBSCRIBE",
    "subscription": "{...}"
  }
  ```
  :::

  :::prose-accordion-item{icon="i-lucide-calendar" badge="INSTALLMENT"}

  #label
  ### 分期支付

  #content
  将总金额分成多笔较小的支付，分期完成。这降低了客户的前期成本，可提高高价商品的转化率。

  适用场景：高价商品、消费电子、家具、奢侈品。

  ```json
  {
    "productType": "CARD",
    "subProductType": "INSTALLMENT"
  }
  ```
  :::
::

### 支付模式选择指南

| 如果您需要... | 使用 | 核心优势 |
|--------------|------|---------|
| 处理一次性支付 | `DIRECT` | 简单且即时结算 |
| 安全保存支付方式 | `TOKEN` | 降低 PCI 合规范围，加快复购 |
| 按定期计划扣款 | `SUBSCRIBE` | 自动化账单，提高留存 |
| 提供灵活的支付条款 | `INSTALLMENT` | 降低门槛，提高转化 |

### 支付模式兼容性

| 产品类型 | 支持的支付模式 |
|---------|---------------|
| `CARD` | DIRECT、TOKEN、SUBSCRIBE、INSTALLMENT |
| `LPMS` | DIRECT、SUBSCRIBE |
| `PAYMENT_CODE` | DIRECT |
| `ORDER_CODE` | DIRECT |

## 指定交易类型

`txnType` 参数决定 Onerway 如何处理支付。不同的交易类型对应不同的资金流向。

::prose-accordion
---
type: multiple
defaultValue: ["0", "1", "2", "3"]
---

  :::prose-accordion-item{icon="i-lucide-shopping-cart" badge="SALE"}

  #label
  ### 标准交易

  #content
  处理标准支付交易。客户完成支付时立即扣款。

  适用场景：最常见的交易类型，用于一次性购买和即时收款。

    ::::prose-tabs{variant="pill" sync="product-type"}
      :::::prose-tabs-item{label="银行卡" value="card" icon="i-lucide-credit-card"}
      ```json
      {
        "productType": "CARD",
        "subProductType": "DIRECT",
        "txnType": "SALE"
      }
      ```
      :::::

      :::::prose-tabs-item{label="本地支付" value="lpms" icon="i-lucide-wallet"}
      ```json
      {
        "lpmsInfo": "{\"lpmsType\":\"WeChat\"}",
        "productType": "LPMS",
        "subProductType": "DIRECT",
        "txnType": "SALE"
      }
      ```
      :::::
    ::::
  :::

  :::prose-accordion-item{icon="i-lucide-undo-2" badge="REFUND"}

  #label
  ### 退款

  #content
  撤销已完成的交易并将资金返还给客户。Onerway 将销售视为正向交易，退款视为逆向交易。

  适用场景：处理客户对已完成支付的退款请求。

  您将在 API 查询响应和 Webhook 通知中看到此交易类型：

  ```json
  {
    "txnType": "REFUND"
  }
  ```
  :::

  :::prose-accordion-item{icon="i-lucide-save" badge="BIND_CARD"}

  #label
  ### 绑卡

  #content
  保存客户的卡片信息而不进行扣款。这将创建一个可用于后续支付的令牌。

  适用场景：收集支付方式信息以供后续使用而不立即扣款，如试用注册或延迟计费。

  您将在 API 查询响应和 Webhook 通知中看到此交易类型：

  ```json
  {
    "txnType": "BIND_CARD"
  }
  ```
  :::

  :::prose-accordion-item{icon="i-lucide-lock"}
  ---
  badges:
    - label: AUTH
    - label: CAPTURE
    - label: VOID
  ---

  #label
  ### 预授权

  #content
  预授权在客户的卡片上冻结资金，但不立即扣款。适用于最终金额尚未确定的场景，如酒店预订或租车。

  预授权流程包含三个步骤：

  ```mermaid
  flowchart LR
      A([开始]) --> B(AUTH)
      B -->|冻结资金| C{决策}
      C -->|全额扣款| D(CAPTURE $100)
      C -->|部分扣款| E(CAPTURE $75)
      C -->|取消| F(VOID)
      C -.->|无操作| G(已过期)
      D --> H([完成])
      E --> H
      E -.->|$25 自动释放| I([已释放])
      F --> I
      G -->|7 天后| I
  ```

  **1. 授权 (AUTH)** — 在客户卡片上冻结资金：

  ```json
  {
    "txnType": "AUTH",
    "amount": "10000",
    "currency": "USD"
  }
  ```

  **2. 扣款 (CAPTURE)** — 完成扣款（全额或部分金额）：

  ```json
  {
    "txnType": "CAPTURE",
    "originTransactionId": "original_auth_transaction_id"
  }
  ```

  **3. 撤销 (VOID)** — 取消授权并释放资金：

  ```json
  {
    "txnType": "VOID",
    "originTransactionId": "original_auth_transaction_id"
  }
  ```

  如果未扣款，授权将自动过期并释放资金。

    ::::warning
    授权默认在 7 天后过期。可在您的[账户设置](#){badge="TODO"}中配置。未扣款的资金将自动释放。
    ::::

    ::::tip
    您可以扣款少于授权金额的金额。例如，授权 $100，扣款 $75，剩余的 $25 将自动释放。
    ::::
  :::
::

## 移动钱包集成

某些数字钱包（如微信支付和 DANA）可以在移动设备上启动其原生 App，提供无缝的支付体验。指定额外参数以启用 App 内支付。

| 参数 | 描述 | 值 |
|------|------|-----|
| `paymentMode` | 支付发起方式 | `IN_APP`、`WEB` |
| `osType` | 客户的操作系统 | `IOS`、`ANDROID` |
| `lpmsInfo` | 本地支付方式详情 | 包含 `lpmsType` 的 JSON 字符串 |

::prose-tabs{variant="pill"}
  :::prose-tabs-item{label="微信支付 (iOS)" value="wechat" icon="i-lucide-smartphone"}
  ```json
  {
    "productType": "LPMS",
    "subProductType": "DIRECT",
    "txnType": "SALE",
    "paymentMode": "IN_APP",
    "osType": "IOS",
    "lpmsInfo": "{\"lpmsType\":\"WeChat\"}"
  }
  ```
  :::

  :::prose-tabs-item{label="DANA (Android)" value="dana" icon="i-lucide-smartphone"}
  ```json
  {
    "productType": "LPMS",
    "subProductType": "DIRECT",
    "txnType": "SALE",
    "paymentMode": "IN_APP",
    "osType": "ANDROID",
    "lpmsInfo": "{\"lpmsType\":\"DANA\"}"
  }
  ```
  :::
::

::note
有关支持的本地支付方式及其集成要求的完整列表，请参阅[本地支付方式指南](#){badge="TODO"}。
::
